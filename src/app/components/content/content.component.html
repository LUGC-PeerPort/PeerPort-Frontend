<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
<section class="content-section">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Saira:ital,wght@0,100..900;1,100..900&family=Stack+Sans+Headline:wght@200..700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <div class="content-layout">
    <button class="create-contbtn" *ngIf="!student" (click)="createPressed('')">{{ create && parentId===undefined ? "Close create" : "Create content" }}</button>
    <!-- Top-level create form (when creating a top-level content) -->
    <div *ngIf="create && parentId === undefined" class="contentData">
      <ng-container *ngTemplateOutlet="contentCreateEditTemplate"></ng-container>
    </div>

    <!-- start rendering recursive content -->
    <ul *ngFor="let content of contentList">
      <ng-container *ngTemplateOutlet="renderContent; context: {$implicit: content}"></ng-container>
    </ul>

  </div>
</section>

<!-- Used for the create and update template (doesn't load on the page here)-->
<ng-template #contentCreateEditTemplate>
  <form>
    <label for="name">Name:</label>
    <input id="name" [(ngModel)]="name" name="name" required />

    <label for="description">Description:</label>
    <textarea id="description" [(ngModel)]="description" name="description"></textarea>

    <label for="viewable">Viewable:</label>
    <select id="viewable" [(ngModel)]="viewable" name="viewable">
      <option value="true">True</option>
      <option value="false">False</option>
    </select>

    <label for="fileInput">Upload File:</label>
    <input type="file" id="fileInput" #fileInput multiple (change)="onFilesSelected(fileInput.files)" />

    <ul *ngIf="selectedFiles.length">
      <li *ngFor="let f of selectedFiles; let i = index">
        {{ f.name }} — {{ Math.round(f.size / (1024 * 1024) * 100) / 100 }} MB
        <button type="button" (click)="removeSelectedFile(i)">Remove</button>
      </li>
    </ul>

    <button type="button" *ngIf="create" (click)="createContent()">Add</button>
    <button type="button" *ngIf="!create" (click)="editContent()" class="savebtn">Save</button>
  </form>
</ng-template>

<!-- Template for rendering content recursively (doesn't load on the page here) -->

<ng-template #renderContent let-node>
  <li class="content-panel" *ngIf="node.viewable || !student" (click)="toggleContent(node); $event.stopPropagation()">
    <h4>{{ node.name }}</h4>
    <div class="viewable">
    <a *ngIf="!student">{{ node.viewable ? 'View' : 'Not Viewable' }}</a>
</div>
    <div class="content-meta">
      <small *ngIf="node.dateCreated">Created: {{ node.dateCreated | date:'short' }}</small>
      <small *ngIf="node.dateUpdated"> • Updated: {{ node.dateUpdated | date:'short' }}</small>
    </div>

      <div *ngIf="node.expanded" class="content-content" (click)="$event.stopPropagation()">
      <div class="description"></div>
        <p *ngIf="node.description">{{ node.description }}</p>
     
        <p>Attachments:</p>
      <div *ngIf="node.files.length > 0">
        <iframe *ngFor="let file of node.files" [src]="file.url" loading="lazy"></iframe>
      </div>
      <button *ngIf="!student" (click)="loadData(node); $event.stopPropagation()">{{ !create && contentId == node.contentId ? "Close" : "Edit" }}</button>
      <button *ngIf="!student" (click)="createPressed(node.contentId)">{{ create && parentId === node.contentId ? "Close create" : "Add sub-content" }}</button>

      <!-- Inline create form for this node -->
      <div *ngIf="(create && parentId === node.contentId) || contentId === node.contentId" class="contentData">
        <ng-container *ngTemplateOutlet="contentCreateEditTemplate"></ng-container>
      </div>

      <!-- nested subContent -->
      <ul class="subcontent-list" *ngIf="node.subContent?.length">
        <ng-container *ngFor="let child of node.subContent">
          <ng-container *ngTemplateOutlet="renderContent; context: {$implicit: child}"></ng-container>
        </ng-container>
      </ul>
    </div>
  </li>
    
</ng-template>